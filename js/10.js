(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"126":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=n(1),a=_interopRequireDefault(o),i=_interopRequireDefault(n(0)),u=n(42),c=n(44),l=n(49),s=_interopRequireDefault(n(45)),p=_interopRequireDefault(n(64)),f=n(8);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(127);var d=function(e){function Reply(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Reply);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Reply.__proto__||Object.getPrototypeOf(Reply)).apply(this,arguments));return e.handleChange=function(t){e.setState({"content":t.target.value})},e.state={"hasErr":!1,"content":"","author_txt":"\n\n 来自拉风的 [Taro-cnode](https://github.com/icai/taro-cnode)"},e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Reply,o.Component),r(Reply,[{"key":"componentWillReceiveProps","value":function componentWillReceiveProps(e){}},{"key":"componentDidMount","value":function componentDidMount(){this.props.replyTo&&this.setState({"content":"@"+this.props.replyTo})}},{"key":"addReply","value":function addReply(){var e=this,t=this.state,n=t.content,r=t.author_txt,o=this.props,i=o.userInfo,u=(o.topic,o.topicId),c=o.replyId,l=o.show,s=o.updateReplies;if(n){var d=new Date,y={"accesstoken":i.token,"content":n+r};c&&(y.reply_id=c),(0,f.post)({"data":y,"url":"https://cnodejs.org/api/v1/topic/"+u+"/replies"}).then(function(t){var r=t.data;r.success?(s&&s(function(e,t){var o=(0,p.default)(e.replies,{"$push":[{"id":r.reply_id,"author":{"loginname":i.loginname,"avatar_url":i.avatar_url},"content":n,"ups":[],"create_at":d}]});e.replies=o,t.setState({"topic":e})}),e.setState({"content":""}),l&&e.props.onClose()):a.default.showToast({"title":r.error_msg})}).catch(function(e){console.info(e)})}else this.setState({"hasErr":!0})}},{"key":"render","value":function render(){var e=this.state.hasErr;return i.default.createElement(u.View,{"className":"reply"},i.default.createElement(l.AtTextarea,{"id":"content","className":(0,s.default)({"text":1,"err":e}),"value":this.state.content,"onChange":this.handleChange,"type":"text","placeholder":"回复支持Markdown语法,请注意标记代码","rows":"8","class":"text"}),i.default.createElement(u.View,{"className":"button","onClick":this.addReply.bind(this)},"确定"))}}]),Reply}();t.default=(0,c.withUser)(d)},"127":function(e,t,n){},"129":function(e,t,n){},"40":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=n(1),a=_interopRequireDefault(n(0)),i=n(42),u=_interopRequireDefault(n(47)),c=_interopRequireDefault(n(46)),l=_interopRequireDefault(n(126)),s=_interopRequireDefault(n(45)),p=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),f=n(44),d=_interopRequireDefault(n(64)),y=n(8),h=_interopRequireDefault(n(55));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(129);var m=function(e){function Topic(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Topic);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Topic.__proto__||Object.getPrototypeOf(Topic)).apply(this,arguments));return e.config={"navigationBarTitleText":"主题"},e.getTopic=function(){var t=e.$router.params.id;e.setState({"topicId":t}),(0,y.get)({"url":"https://cnodejs.org/api/v1/topic/"+t}).then(function(t){var n=t.data;n&&n.data?e.setState({"topic":n.data}):e.setState({"noData":!0})})},e.state={"showMenu":!1,"topic":{"title":"","create_at":"","visit_count":0,"content":"","tab":"","good":!1,"top":!1,"reply_count":0,"author":{"avatar_url":"","loginname":""},"replies":[]},"noData":!1,"topicId":"","curReplyId":""},e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Topic,o.Component),r(Topic,[{"key":"componentDidMount","value":function componentDidMount(){this.getTopic()}},{"key":"addReply","value":function addReply(e){this.setState({"curReplyId":e}),this.props.userInfo.userId}},{"key":"hideItemReply","value":function hideItemReply(){this.setState({"curReplyId":""})}},{"key":"upReply","value":function upReply(e,t){var n=this,r=this.props.userInfo,o=this.state.topic;r.userId?(0,y.post)({"url":"https://cnodejs.org/api/v1/reply/"+e.id+"/ups","data":{"accesstoken":r.token}}).then(function(a){var i=a.data;if(i.success){if("down"===i.action){var u=p.inArray(r.userId,e.ups);e.ups.splice(u,1)}else e.ups.push(r.userId);(0,d.default)(o.replies,function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{"value":n,"enumerable":!0,"configurable":!0,"writable":!0}):e[t]=n,e}({},t,{"$set":e})),n.setState({"topic":o})}}):p.navigateTo({"url":"/pages/login/index","params":{"redirect":encodeURIComponent(this.$router.fullUrl)}})}},{"key":"render","value":function render(){var e=this,t=this.state,n=t.noData,r=t.topicId,o=t.showMenu,f=t.curReplyId,d=t.topic,y=this.props.userInfo,m=function getLastTimeStr(e,t){return p.getLastTimeStr(e,t)},v=function getTabInfo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments[2],r=arguments[3];return p.getTabInfo(e,t,n,r)},b=d.replies.map(function(t,n){return a.default.createElement(i.View,{"className":"li flex-wrp"},a.default.createElement(i.View,{"className":"user"},a.default.createElement(c.default,{"to":{"url":"/pages/user/index","params":{"loginname":t.author.loginname}}},a.default.createElement(i.Image,{"className":"head","src":t.author.avatar_url})),a.default.createElement(i.View,{"className":"info"},a.default.createElement(i.Text,{"className":"cl"},a.default.createElement(i.Text,{"className":"name"},t.author.loginname),a.default.createElement(i.Text,{"className":"name mt10"},a.default.createElement(i.Text,null),"发布于:",m(t.create_at,!0))),a.default.createElement(i.Text,{"className":"cr"},a.default.createElement(i.Text,{"className":(0,s.default)({"iconfont":1,"icon":1,"uped":function isUps(e){return e.includes((y||{}).userId)}(t.ups)}),"onClick":e.upReply.bind(e,t,n)},""),t.ups.length,a.default.createElement(i.Text,{"className":"iconfont icon","onClick":e.addReply.bind(e,t.id)},"")))),a.default.createElement(i.View,{"className":"reply_content","dangerouslySetInnerHTML":{"__html":t.content}}),y.userId&&f===t.id?a.default.createElement(l.default,{"topic":d,"updateReplies":function updateReplies(t){t(d,e)},"topicId":r,"replyId":t.id,"replyTo":t.author.loginname,"show":f,"onClose":e.hideItemReply.bind(e)}):"")});return a.default.createElement(i.View,{"className":"flex-wrp"},a.default.createElement(u.default,{"pageType":"主题","fixHead":!0,"needAdd":!0}),d.title?a.default.createElement(i.View,{"className":(0,s.default)({"page-box":1,"show-menu":o})},a.default.createElement(i.View,{"className":"topic-title"},d.title),a.default.createElement(i.View,{"className":"author-info"},a.default.createElement(c.default,{"to":{"url":"/pages/user/index","params":{"loginname":d.author.loginname}}},a.default.createElement(i.Image,{"className":"avatar","src":d.author.avatar_url})),a.default.createElement(i.View,{"className":"col"},a.default.createElement(i.Text,null,d.author.loginname),a.default.createElement(i.Text,{"className":"time"},"发布于:",m(d.create_at,!0))),a.default.createElement(i.View,{"className":"right"},a.default.createElement(i.Text,{"className":"tag "+v(d.tab,d.good,d.top,!0)},v(d.tab,d.good,d.top,!1)),a.default.createElement(i.Text,{"className":"name"},d.visit_count,"次浏览"))),a.default.createElement(i.View,{"className":"markdown-body topic-content","dangerouslySetInnerHTML":{"__html":d.content}}),a.default.createElement(i.View,{"className":"topic-reply"},a.default.createElement(i.Text,{"className":"strong"},d.reply_count)," 回复"),a.default.createElement(i.View,{"className":"reply-list"},a.default.createElement(i.View,{"className":"ul"},b)),a.default.createElement(h.default,null),y.userId?a.default.createElement(l.default,{"topic":d,"updateReplies":function updateReplies(t){t(d,e)},"topicId":r}):""):"",n?a.default.createElement(i.View,{"className":"no-data"},a.default.createElement("i",{"className":"iconfont icon-empty"},""),"该话题不存在!"):"")}}]),Topic}();t.default=(0,f.withUser)(m,!0)},"44":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.withUser=t.Component=void 0;var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},a=n(1),i=_interopRequireDefault(a),u=_interopRequireWildcard(n(43)),c=(_interopRequireDefault(n(0)),n(6)),l=_interopRequireWildcard(n(7));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}t.Component=a.Component,t.withUser=function withUser(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(n){function WithUserHOC(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WithUserHOC);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(WithUserHOC.__proto__||Object.getPrototypeOf(WithUserHOC)).apply(this,arguments));return e.props.authCheckState(),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WithUserHOC,e),r(WithUserHOC,[{"key":"isSuperRender","value":function isSuperRender(){var e=this.props;return t||e.userInfo&&e.userInfo.userId}},{"key":"perform","value":function perform(){this.isSuperRender()||i.default.redirectTo({"url":"/pages/login/index"})}},{"key":"componentWillMount","value":function componentWillMount(){this.perform()}},{"key":"render","value":function render(){return this.isSuperRender()?o(WithUserHOC.prototype.__proto__||Object.getPrototypeOf(WithUserHOC.prototype),"render",this).call(this):null}}]),WithUserHOC}();return n=u.__decorate([(0,c.connect)(function(e){return{"userInfo":e.auth}},function(e){return{"authLogin":function authLogin(){return e(l.auth.apply(l,arguments))},"authCheckState":function authCheckState(){return e(l.authCheckState())}}})],n)}},"48":function(e,t,n){"use strict";function throttle(e,t,n,r){var o,a=0;return"boolean"!=typeof t&&(r=n,n=t,t=void 0),function wrapper(){var i=this,u=Number(new Date)-a,c=arguments;function exec(){a=Number(new Date),n.apply(i,c)}r&&!o&&exec(),o&&clearTimeout(o),void 0===r&&u>e?exec():!0!==t&&(o=setTimeout(r?function clear(){o=void 0}:exec,void 0===r?e-u:e))}}Object.defineProperty(t,"__esModule",{"value":!0}),t.throttle=throttle,t.debounce=function debounce(e,t,n){return void 0===n?throttle(e,t,!1):throttle(e,n,!1!==t)}},"55":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=n(1),a=_interopRequireDefault(o),i=_interopRequireDefault(n(0)),u=n(42),c=n(48);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(56);var l=function(e){function BackTop(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BackTop);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(BackTop.__proto__||Object.getPrototypeOf(BackTop)).apply(this,arguments));return e.handleScroll=function(){var t=e.componentScrollBox.scrollTop>=.5*document.body.clientHeight;e.setState({"show":t})},e.onPageScroll=function(t){var n=t.scrollTop>500;e.setState({"show":n})},e.goTop=function(){"WEB"==a.default.getEnv()?e.componentScrollBox.scrollTop=0:"WEAPP"==a.default.getEnv()&&a.default.pageScrollTo({"scrollTop":0})},e.state={"show":!1},"WEB"==a.default.getEnv()&&(e.componentScrollBox=document.documentElement),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(BackTop,o.Component),r(BackTop,[{"key":"componentWillUnmount","value":function componentWillUnmount(){"WEB"==a.default.getEnv()&&window.removeEventListener("scroll",this.scrollbinding)}},{"key":"componentDidMount","value":function componentDidMount(){"WEB"==a.default.getEnv()&&(this.scrollbinding=(0,c.throttle)(300,this.handleScroll),window.addEventListener("scroll",this.scrollbinding))}},{"key":"render","value":function render(){var e=this.state.show;return i.default.createElement(u.View,null,e?i.default.createElement(u.View,{"className":"iconfont icon-top","onClick":this.goTop},""):"")}}]),BackTop}();t.default=l},"56":function(e,t,n){},"64":function(e,t,n){var r=n(9),o=Object.prototype.hasOwnProperty,a=Array.prototype.splice,i=Object.prototype.toString,u=function(e){return i.call(e).slice(8,-1)},c=Object.assign||function assign(e,t){return l(t).forEach(function(n){o.call(t,n)&&(e[n]=t[n])}),e},l="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function copy(e){if(Array.isArray(e))return c(e.constructor(e.length),e);if("Map"===u(e))return new Map(e);if("Set"===u(e))return new Set(e);if(e&&"object"==typeof e){var t=Object.getPrototypeOf(e);return c(Object.create(t),e)}return e}function newContext(){var e=c({},s);return update.extend=function(t,n){e[t]=n},update.isEquals=function(e,t){return e===t},update;function update(t,n){"function"==typeof n&&(n={"$apply":n}),Array.isArray(t)&&Array.isArray(n)||r(!Array.isArray(n),"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."),r("object"==typeof n&&null!==n,"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: %s.",Object.keys(e).join(", "));var a=t;return l(n).forEach(function(r){if(o.call(e,r)){var i=t===a;a=e[r](n[r],a,n,t),i&&update.isEquals(a,t)&&(a=t)}else{var c="Map"===u(t)?update(t.get(r),n[r]):update(t[r],n[r]),l="Map"===u(a)?a.get(r):a[r];update.isEquals(c,l)&&(void 0!==c||o.call(t,r))||(a===t&&(a=copy(t)),"Map"===u(a)?a.set(r,c):a[r]=c)}}),a}}var s={"$push":function(e,t,n){return invariantPushAndUnshift(t,n,"$push"),e.length?t.concat(e):t},"$unshift":function(e,t,n){return invariantPushAndUnshift(t,n,"$unshift"),e.length?e.concat(t):t},"$splice":function(e,t,n,o){return function invariantSplices(e,t){r(Array.isArray(e),"Expected $splice target to be an array; got %s",e),invariantSplice(t.$splice)}(t,n),e.forEach(function(e){invariantSplice(e),t===o&&e.length&&(t=copy(o)),a.apply(t,e)}),t},"$set":function(e,t,n){return function invariantSet(e){r(1===Object.keys(e).length,"Cannot have more than one key in an object with $set")}(n),e},"$toggle":function(e,t){invariantSpecArray(e,"$toggle");var n=e.length?copy(t):t;return e.forEach(function(e){n[e]=!t[e]}),n},"$unset":function(e,t,n,r){return invariantSpecArray(e,"$unset"),e.forEach(function(e){Object.hasOwnProperty.call(t,e)&&(t===r&&(t=copy(r)),delete t[e])}),t},"$add":function(e,t,n,r){return invariantMapOrSet(t,"$add"),invariantSpecArray(e,"$add"),"Map"===u(t)?e.forEach(function(e){var n=e[0],o=e[1];t===r&&t.get(n)!==o&&(t=copy(r)),t.set(n,o)}):e.forEach(function(e){t!==r||t.has(e)||(t=copy(r)),t.add(e)}),t},"$remove":function(e,t,n,r){return invariantMapOrSet(t,"$remove"),invariantSpecArray(e,"$remove"),e.forEach(function(e){t===r&&t.has(e)&&(t=copy(r)),t.delete(e)}),t},"$merge":function(e,t,n,o){return function invariantMerge(e,t){r(t&&"object"==typeof t,"update(): $merge expects a spec of type 'object'; got %s",t),r(e&&"object"==typeof e,"update(): $merge expects a target of type 'object'; got %s",e)}(t,e),l(e).forEach(function(n){e[n]!==t[n]&&(t===o&&(t=copy(o)),t[n]=e[n])}),t},"$apply":function(e,t){return function invariantApply(e){r("function"==typeof e,"update(): expected spec of $apply to be a function; got %s.",e)}(e),e(t)}},p=newContext();function invariantPushAndUnshift(e,t,n){r(Array.isArray(e),"update(): expected target of %s to be an array; got %s.",n,e),invariantSpecArray(t[n],n)}function invariantSpecArray(e,t){r(Array.isArray(e),"update(): expected spec of %s to be an array; got %s. Did you forget to wrap your parameter in an array?",t,e)}function invariantSplice(e){r(Array.isArray(e),"update(): expected spec of $splice to be an array of arrays; got %s. Did you forget to wrap your parameters in an array?",e)}function invariantMapOrSet(e,t){var n=u(e);r("Map"===n||"Set"===n,"update(): %s expects a target of type Set or Map; got %s",t,n)}e.exports=p,e.exports.default=p,e.exports.newContext=newContext}}]);