{"version":3,"sources":["webpack:///./.temp/pages/message/index.scss?50b7","webpack:///./.temp/pages/message/index.scss","webpack:///./.temp/pages/message/index.js","webpack:///./.temp/hoc/router.js"],"names":["content","__webpack_require__","module","i","options","sourceMap","hmr","transform","insertInto","undefined","locals","exports","push","version","sources","names","mappings","file","sourceRoot","_taroH","_router","_components","utils","_request","Message","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","apply","arguments","config","navigationBarTitleText","changeItem","idx","currentData","state","message","hasnot_read_messages","has_read_messages","setState","prevState","_extends","selectItem","noData","length","markall","userInfo","props","post","url","data","accesstoken","token","then","resp","d","success","window","location","reload","showMenu","no_read_len","Component","_this2","get","willdata","_state","_nervjs2","default","createElement","View","className","_index2","pageType","fixHead","needAdd","messageCount","id","_classnames2","item","br","selected","onClick","bind","Text","map","Image","src","author","avatar_url","loginname","type","getLastTimeStr","date","friendly","reply","create_at","dangerouslySetInnerHTML","__html","_link2","to","params","topic","title","withUser","tslib_1","_reduxH","actions","WrappedComponent","allowNologin","WithUserHOC","authCheckState","_inherits","_createClass","key","value","isSuperRender","userId","perform","Taro","redirectTo","componentWillMount","render","_get","prototype","call","__decorate","connect","_ref","auth","dispatch","authLogin"],"mappings":"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","file":"chunk/message_index.js","sourcesContent":["\nvar content = require(\"!!../../../node_modules/css-loader/index.js??ref--8-1!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/lib/loader.js??ref--8-4!./index.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"sourceMap\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--8-1!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/lib/loader.js??ref--8-4!./index.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js??ref--8-1!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/lib/loader.js??ref--8-4!./index.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(true);\n// imports\n\n\n// module\nexports.push([module.id, \"\", \"\", {\"version\":3,\"sources\":[],\"names\":[],\"mappings\":\"\",\"file\":\"index.scss\",\"sourceRoot\":\"\"}]);\n\n// exports\n","import { Component } from \"@tarojs/taro-h5\";\nimport Nerv from \"nervjs\";\nimport { withUser } from \"../../hoc/router\";\nimport { View, Image, Text } from '@tarojs/components';\nimport Link from \"../../components/link\";\nimport Header from '../../components/header/index';\nimport classNames from \"classnames\";\nimport * as utils from '../../libs/utils';\nimport { post, get } from \"../../utils/request\";\nimport './index.scss';\nclass Message extends Component {\n  constructor() {\n    super(...arguments);\n\n    this.state = {\n      showMenu: false,\n      selectItem: 2,\n      message: {\n        hasnot_read_messages: [],\n        has_read_messages: []\n      },\n      noData: false,\n      currentData: [],\n      no_read_len: 0\n    };\n  }\n  componentDidShow() {\n    const { userInfo } = this.props;\n    get({\n      url: 'https://cnodejs.org/api/v1/messages?accesstoken=' + userInfo.token\n    }).then(resp => {\n      const d = resp.data;\n      const willdata = {};\n      if (d && d.data) {\n        willdata.message = d.data;\n        willdata.no_read_len = d.data.hasnot_read_messages.length;\n        if (d.data.hasnot_read_messages.length > 0) {\n          willdata.currentData = d.data.hasnot_read_messages;\n        } else {\n          willdata.currentData = d.data.has_read_messages;\n          willdata.selectItem = 2;\n        }\n        willdata.noData = willdata.currentData.length === 0;\n      } else {\n        willdata.noData = true;\n      }\n      this.setState({ ...willdata });\n    });\n  }\n  render() {\n    const { currentData, no_read_len, selectItem, noData } = this.state;\n    const getLastTimeStr = (date, friendly) => {\n      return utils.getLastTimeStr(date, friendly);\n    };\n    return <View className=\"flex-wrp\">\n        <Header pageType={\"消息\"} fixHead={true} showMenu={true} needAdd={true} messageCount={no_read_len}></Header>\n        <View id=\"page\" className=\"page\">\n            <View className=\"tabs\">\n            <View className={classNames({ 'item': 1, 'br': 1, \"selected\": selectItem === 2 })} onClick={this.changeItem.bind(this, 2)}>已读消息</View>\n            <View className={classNames({ 'item': 1, \"selected\": selectItem === 1 })} onClick={this.changeItem.bind(this, 1)}>\n                    未读消息\n                    {no_read_len > 0 ? <Text className=\"iconfont read\" onClick={this.markall}></Text> : ''}\n                </View>\n            </View>\n            <View className=\"tab-content\">\n              {currentData.map((item, idx) => {\n            return <View className=\"message markdown-body\">\n                      <View className=\"user\">\n                        <Image className=\"head\" src={item.author.avatar_url} />\n                        <View className=\"info\">\n                          <Text className=\"cl\">\n                            <Text className=\"name\">\n                              {item.author.loginname}\n                            </Text>\n                            {item.type === 'at' ? <Text className=\"name\">\n                                在回复中@了您\n                              </Text> : \"\"}\n                            {item.type === 'reply' ? <Text className=\"name\">\n                                回复了您的话题\n                              </Text> : \"\"}\n                          </Text>\n                          <Text className=\"cr\">\n                            <Text className=\"name\">\n                              {getLastTimeStr(item.reply.create_at, true)}\n                            </Text>\n                          </Text>\n                        </View>\n                      </View>\n                    <View className=\"reply_content\" dangerouslySetInnerHTML={{ __html: item.reply.content }}>\n                      </View>\n                      <Link to={{ url: \"/pages/topic/index\", params: { id: item.topic.id } }}>\n                        <View className=\"topic-title\">\n                          话题：\n                          {item.topic.title}\n                        </View>\n                      </Link>\n                    </View>;\n          })}\n              {noData ? <View className=\"no-data\">\n                    <i className=\"iconfont icon-empty\"></i>\n                    暂无数据!\n                </View> : ''}\n            </View>\n\n        </View>\n\n    </View>;\n  }\n  config = {\n    navigationBarTitleText: '消息'\n  };\n  changeItem = idx => {\n    const currentData = idx === 1 ? this.state.message.hasnot_read_messages : this.state.message.has_read_messages;\n    this.setState(prevState => ({\n      ...prevState,\n      selectItem: idx,\n      currentData: currentData,\n      noData: currentData.length === 0\n    }));\n  };\n  markall = () => {\n    const { userInfo } = this.props;\n    post({\n      url: 'https://cnodejs.org/api/v1/message/mark_all',\n      data: {\n        accesstoken: userInfo.token\n      }\n    }).then(resp => {\n      const d = resp.data;\n      if (d && d.success) {\n        window.location.reload();\n      }\n    });\n  };\n}\nexport default withUser(Message);","import Taro from '@tarojs/taro-h5';\nimport * as tslib_1 from \"tslib\";\nimport { Component } from \"@tarojs/taro-h5\";\nimport Nerv from \"nervjs\";\nimport { connect } from \"@tarojs/redux-h5\";\nimport * as actions from \"../actions/auth\";\nfunction withUser(WrappedComponent, allowNologin = false) {\n  let WithUserHOC = class WithUserHOC extends WrappedComponent {\n    constructor() {\n      super(...arguments);\n      this.props.authCheckState();\n    }\n    isSuperRender() {\n      const props = this.props;\n      return allowNologin || props.userInfo && props.userInfo.userId;\n    }\n    // refer  https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Redirect.js\n    perform() {\n      if (!this.isSuperRender()) {\n        Taro.redirectTo({ url: \"/pages/login/index\" });\n      }\n    }\n    componentWillMount() {\n      this.perform();\n    }\n    render() {\n      if (this.isSuperRender()) {\n        return super.render();\n      } else {\n        return null;\n      }\n    }\n  };\n  WithUserHOC = tslib_1.__decorate([connect(({ auth }) => ({ userInfo: auth }), dispatch => ({\n    authLogin: (...args) => dispatch(actions.auth(...args)),\n    authCheckState: () => dispatch(actions.authCheckState())\n  }))], WithUserHOC);\n  ;\n  return WithUserHOC;\n}\nexport { Component, withUser };"],"sourceRoot":""}